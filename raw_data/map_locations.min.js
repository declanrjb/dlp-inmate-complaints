var strBtnSelected="";var url=window.location.href;var urlParmas=null;var urlParams=(url.indexOf("?")!=-1)?url.substring(url.indexOf("?")+1,url.length):null;var params=(urlParams!=null)?urlParams.split("&"):new Array();var blocker=null;var MapPresets={USA:[37.1561429929983,-97.11953125000002,3],WXR:[37.324355708596016,-123.27414393424988,3],MXR:[37.435815987563174,-81.29921875000002,6],SER:[26.59633655640737,-79.32587563991547,4],NER:[42.6527593609859,-74.70511749386787,5],NCR:[42.798032031210695,-93.57962921261787,5],SCR:[32.01111683764681,-99.29251983761787,5],AK:[63.672070580335784,-151.65436685085297,3],AL:[32.716081489655224,-85.36286294460297,6],AR:[34.69009214699914,-92.03156411647797,7],AZ:[34.35518159970196,-111.97174966335297,6],CA:[37.764591344833654,-119.48639810085297,5],CT:[41.59890073097112,-72.55547046661377,8],CO:[38.85078777236573,-105.07233560085297,6],DC:[38.891567269117,-77.00798034667969,11],DE:[39.013165123386756,-75.09613931179047,8],FL:[28.14267300017464,-82.56134927272797,6],GA:[32.54028324342992,-82.58332192897797,6],HI:[20.471224741665,-157.22443521022797,7],IA:[41.92669145497647,-93.13011646270752,7],ID:[45.26943511254707,-114.76227700710297,5],IL:[39.92064784087214,-88.32917153835297,6],IN:[40.08895616950157,-85.49469888210297,6],KS:[38.395878329514815,-98.09601724147797,7],KY:[37.78195942880724,-85.78034341335297,7],LA:[30.980387019906185,-91.46027505397797,7],MA:[41.996131191991566,-71.46507740020752,8],MD:[38.78873004085005,-77.07917153835297,8],ME:[45.43690289168765,-68.05656909942627,6],MI:[45.03700444699605,-84.70368325710297,6],MN:[46.29605430337147,-92.65778481960297,6],MO:[38.35281349128599,-91.73493325710297,6],MS:[32.299158605814476,-89.83429849147797,6],MT:[46.553533671109584,-109.20319497585297,6],NC:[35.266207383495924,-79.77082192897797,7],ND:[47.42284656673162,-100.00763833522797,7],NE:[41.486318298529824,-99.98566567897797,7],NH:[43.957128346578486,-71.25908374786377,7],NJ:[40.26264604554765,-74.37096118927002,7],NM:[34.24627313138787,-105.35798013210297,6],NV:[38.81655571164501,-116.95954263210297,6],NY:[42.96435265822173,-75.05760669708252,6],OH:[40.206525014092314,-81.79230630397797,6],OK:[35.30207983012067,-98.73322427272797,7],OR:[44.04254782585604,-120.50812661647797,6],PA:[40.76378751557313,-77.00218677520752,7],PR:[18.195903309769953,-66.18622720241547,8],RI:[41.65433284470312,-71.50627613067627,9],SC:[33.63561342110893,-80.47394692897797,7],SD:[44.54581445116839,-99.80988442897797,6],TN:[35.516980442503396,-86.29670083522797,7],TX:[31.721578343944664,-98.49152505397797,5],UT:[39.22625275190933,-111.33454263210297,6],VA:[37.7993234326032,-78.82599771022797,7],VT:[43.92548548054049,-72.44560718536377,7],WA:[47.27397350440574,-120.56305825710297,6],WI:[44.865952807806394,-88.98835122585297,6],WV:[38.899967510782396,-80.04548013210297,7],WY:[42.96683356364706,-106.83014810085297,6],HQ:[38.894721,-77.005921,15]};var regionPoly=new Poly();var extraPoly=new Poly();var statePoly=new Poly();var markersArray=[];var mapOptions={center:new google.maps.LatLng(MapPresets.USA[0],MapPresets.USA[1]),zoom:MapPresets.USA[2],mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:false,mapTypeControl:false,panControl:false,zoomControl:false};var map=new google.maps.Map(document.getElementById("map_canvas"),mapOptions);var infowindow=new google.maps.InfoWindow();function createMarker(e){var b=createLatLng(e);var d=true;var g=map.getZoom();var f=getMarkerIcon(g);var h=isClickable(g);var a=new google.maps.Marker({position:b,map:map,icon:f,visible:d,clickable:h});a.set("ftype",e.type);a.set("fsec",e.securityLevel);a.set("fcode",e.code);a.set("fcomplex",e.complexCode);a.setAnimation((g>3)?google.maps.Animation.DROP:"");google.maps.event.addListener(a,"click",function(){infowindow.close();if(a.get("ftype")=="CI"||a.get("ftype")=="RRM"){infowindow.setContent('<div id="iw_container" class="sm"></div>')}else{if(a.get("ftype")=="FCC"){infowindow.setContent('<div id="iw_container" class="fcc"></div>')}else{infowindow.setContent('<div id="iw_container" class="full"></div>')}}infowindow.open(map,a);google.maps.event.addListenerOnce(infowindow,"domready",function(){showInfoWin(a)})});markersArray.push(a)}function showInfoWin(a){var b=isRRC==true?"rrc":"";var e="";var d="";if(a.get("ftype")=="FCC"){d=a.get("fcode")}else{e=a.get("fcode")}$.ajax({url:"/PublicInfo/execute/locations",data:{code:e,region:"",state:"",broadScope:b,complexCode:d,todo:"query",output:"json",rmvePhyCmplxLocs:false}}).done(function(h){if(d==""){var c=h.Locations[0];var j='<h4><a class="link-style3" href="'+c.url+' ">'+c.nameTitle+"</a></h4>";if(isRRC==false&&c.imageSmall!=""){j+='<a class="link-style1" href="'+c.url+'"><img border="0" width="120px" height="60px" src="'+c.imageSmall+'" alt="facility image"/></a>'}j+='<p class="sm"><a class="link-style1" href="'+c.url+'">Facility Details</a><br/><a class="link-style1" ';j+='href="#" onclick="window.open(\'http://maps.google.com/maps?daddr='+c.latitude+","+c.longitude+"');\"";j+=">Driving Directions</a></p>"}else{var g=h.Locations;var j="";var f=a.get("fcode");for(x in g){var c=g[x];if(c.code==f){j="<strong>"+c.nameTitle+":</strong><br/>";break}}j+="<ul>";for(x in g){var c=g[x];if(c.code!=f){j+='<li><a class="link-style1" href="'+c.url+'">'+c.nameTitle+"</a></li>"}}j+="</ul>"}$("#iw_container").fadeOut(0).html(j).fadeIn()})}function createLatLng(a){return new google.maps.LatLng(a.latitude,a.longitude)}function showOverlays(){if(markersArray){for(i in markersArray){markersArray[i].setMap(map)}}regionPoly.addToMap();extraPoly.addToMap();statePoly.addToMap()}function clearOverlays(){if(markersArray){for(i in markersArray){markersArray[i].setMap(null)}}regionPoly.clearFromMap();extraPoly.clearFromMap();statePoly.clearFromMap()}function deleteOverlays(){if(markersArray){for(i in markersArray){markersArray[i].setMap(null)}markersArray.length=0}regionPoly.clearPaths();extraPoly.clearPaths();statePoly.clearPaths();regionPoly.clearFromMap();extraPoly.clearFromMap();statePoly.clearFromMap()}function mapFacl(a){deleteOverlays();$.ajax({url:"/PublicInfo/execute/locations",data:{code:a,todo:"query",output:"json",rmvePhyCmplxLocs:false}}).done(function(b){if(b.Locations.length>0){updateTitle(b.Locations[0].nameTitle);infowindow.close();createMarker(b.Locations[0])}}).done(function(){var b=markersArray[0];map.setCenter(b.getPosition());map.setZoom(15);google.maps.event.addListenerOnce(b,"animation_changed",function(){google.maps.event.trigger(b,"click")})})}function mapSecurity(a){deleteOverlays();$.ajax({url:"/PublicInfo/execute/locations",data:{security:a,todo:"query",output:"json",rmvePhyCmplxLocs:false}}).done(function(b){if(b.Locations.length>0){infowindow.close();for(x in b.Locations){createMarker(b.Locations[x])}if(a=="Administrative"){map.setZoom(3)}else{map.setZoom(4)}repositionMap("USA");google.maps.event.addListenerOnce(m,"animation_changed",function(){google.maps.event.trigger(m,"click")})}else{$("#btn_update_all").click()}})}function mapBroadScope(a){deleteOverlays();$.ajax({url:"/PublicInfo/execute/locations",data:{broadScope:a,todo:"query",output:"json",rmvePhyCmplxLocs:true}}).done(function(c){if(c.Locations.length>0){infowindow.close();for(x in c.Locations){createMarker(c.Locations[x])}if(a=="headquarters"){updateTitle("Headquarters");var b=markersArray[0];map.setCenter(b.getPosition());repositionMap("HQ")}else{if(a=="gfemale"){updateTitle("Female Locations")}else{if(a=="offices"){updateTitle("Office Locations")}else{if(a=="prisons"){updateTitle("Prison Locations")}else{if(a=="prvtfacl"){updateTitle("Private Locations")}else{if(a=="training"){updateTitle("Training Locations")}else{updateTitle(a+" Locations")}}}}}repositionMap("USA");map.setZoom(4)}}else{updateTitle("Our Locations");$("#btn_update_all").click()}})}function mapFaclType(a){deleteOverlays();$.ajax({url:"/PublicInfo/execute/locations",data:{facilityType:a,todo:"query",output:"json",rmvePhyCmplxLocs:false}}).done(function(b){if(b.Locations.length>0){infowindow.close();for(x in b.Locations){createMarker(b.Locations[x])}repositionMap("USA");map.setZoom(4)}else{$("#btn_update_all").click()}})}function repositionMap(c){var b=MapPresets[c];if(b){var a=new google.maps.LatLng(b[0],b[1]);map.setCenter(a);map.setZoom(b[2])}}function mapRegion(b,f){deleteOverlays();var c=$.ajax({url:"/PublicInfo/execute/mapcoords",data:{abbr:b,todo:"query",output:"json"}});var a=$.ajax({url:"/PublicInfo/execute/locations",data:{state:"",region:f,todo:"query",output:"json",rmvePhyCmplxLocs:true}});var e=$.Deferred;if(b=="WXR"||b=="SER"){var d=(b=="WXR")?"HI":"PR";e=$.ajax({url:"/PublicInfo/execute/mapcoords",data:{abbr:d,todo:"query",output:"json",rmvePhyCmplxLocs:true}})}$.when(c,a,e).done(function(n,k,h){repositionMap(b);var j=n[0].Coordinates[0].lstPoints;var g=k[0].Locations;if(h[0]){var l=h[0].Coordinates[0].lstPoints;for(x in l){extraPoly.addPath(createLatLng(l[x]))}}for(x in j){regionPoly.addPath(createLatLng(j[x]))}for(x in g){createMarker(g[x])}showOverlays()})}function mapState(c){deleteOverlays();var b=$.ajax({url:"/PublicInfo/execute/mapcoords",data:{abbr:c,todo:"query",output:"json"}});var a=$.ajax({url:"/PublicInfo/execute/locations",data:{state:c,todo:"query",output:"json",rmvePhyCmplxLocs:true}});$.when(b,a).done(function(g,e){repositionMap(c);if(g[0].Coordinates[0]){updateTitle(g[0].Coordinates[0].name+" Locations");var d=g[0].Coordinates[0].lstPoints;for(x in d){statePoly.addPath(createLatLng(d[x]))}}else{updateTitle("Our Locations")}var f=e[0].Locations;for(x in f){createMarker(f[x])}showOverlays()})}function resetMap(){updateTitle("Our Locations");map.setCenter(mapOptions.center);map.setZoom(mapOptions.zoom);map.setMapTypeId(mapOptions.mapTypeId);setAllLocations();showOverlays()}function resetDisplaOnMap(){$("#select_facil").val("");$("#select_region").val("");$("#select_security").val("");$("#select_broadscope").val("");updateStateList()}function setAllLocations(){for(x in allGPS){var a=allGPS[x];createMarker(a[0],a[1],a[2])}}function isClickable(a){return(a>=6)?true:false}function getMarkerIcon(a){return(a>=6)?"":"/locations/images/sm_map_dot.png"}function Poly(){this.paths=[];this.gPoly=new google.maps.Polygon({strokeColor:"#000000",strokeOpacity:0.5,strokeWeight:2,fillColor:"#000000",fillOpacity:0.2,clickable:false});this.addPath=function(a){this.paths.push(a)};this.clearPaths=function(){this.paths.length=0};this.clearFromMap=function(){this.gPoly.setMap(null)};this.addToMap=function(){if(this.paths.length!=0){this.gPoly.setPaths(this.paths);this.gPoly.setMap(map)}}}function updateTitle(a){$("#section_title_heading").text(a)}function updateStateList(){$(".states-list").css("display","none");var a=$("#select_region").val();$("#select_state").val("");if(a!=""){$("#"+a+"_states").css("display","block")}else{$("#select_state").css("display","block")}}google.maps.event.addListener(map,"dragstart",function(){infowindow.close()});google.maps.event.addListener(map,"click",function(a){var b=map.getZoom();if(b<6){map.setCenter(a.latLng);map.setZoom(6)}});google.maps.event.addListener(map,"zoom_changed",function(){var d=map.getZoom();for(x in markersArray){var a=markersArray[x];var b=getMarkerIcon(d);var e=isClickable(d);a.setIcon(b);a.setClickable(e)}});if(isRRC){updateTitle("Reentry Centers Locations");setAllLocations();showOverlays()}if(params.length==0){setAllLocations();showOverlays()}$("#display_on_map").click(function(){resetDisplaOnMap();blocker=$.blockUI({message:$("#modal"),css:{border:"1px solid #000000",cursor:"default",width:"900px",height:"400px"},overlayCSS:{cursor:"default"},onOverlayClick:$.unblockUI});$(".blockUI.blockMsg").center().showX()});$("#max_map").on("click",function(b){var a=map.getZoom();map.setZoom(a+1);b.preventDefault()});$("#min_map").on("click",function(b){var a=map.getZoom();map.setZoom(a-1);b.preventDefault()});$("#modal_tab1").css("display","block");$("#modal_nav li a").on("click",function(){$("#modal_nav li a").removeClass("link-style1 current");$(this).addClass("link-style1 current");$(".modal-tab").css("display","none");var a=$(this).data("content-id");$("#"+a).css("display","block");$(this).blur()});$("#btn_update_all").on("click",function(){$.unblockUI();window.location="/locations/map.jsp"});$("#select_region").on("change",function(){updateStateList()});$("#btn_update_facility").on("click",function(){var a=$("#select_facil");var b=a.val();var c=a.find("option:selected").text();if(b!=""){mapFacl(b)}else{}$.unblockUI()});$("#select_broadscope").change(function(){$("#select_security").val("");strBtnSelected="#btn_update_broadscope"});$("#select_security").change(function(){$("#select_broadscope").val("");strBtnSelected="#btn_update_security"});$("#btn_update_char").on("click",function(){if(strBtnSelected==""){$("#btn_update_all").click();return}$(strBtnSelected).click()});$("#btn_update_security").on("click",function(){var b=$("#select_security");var c=b.val();var a=b.find("option:selected").text();if(c!=""){updateTitle(a+" Security Locations");mapSecurity(c)}else{$("#btn_update_all").click()}$.unblockUI()});$("#btn_update_broadscope").on("click",function(){var b=$("#select_broadscope");var c=b.val();var a=b.find("option:selected").text();if(c!=""){mapBroadScope(c)}else{$("#btn_update_all").click()}$.unblockUI()});$("#btn_update_regionState").on("click",function(){var b=$("#select_region").val();var d=$("#select_region option:selected").text();var a="";var e="";var c="";if(b==""){a=$("#select_state")}else{a=$("#"+b+"_states")}e=a.val();c=a.find("option:selected").text();if(e!=""){mapState(e);updateTitle(c+" Locations")}else{if(b!=""&&e==""){mapRegion(b,d);updateTitle(d+" Locations")}else{if(b==""&&e==""){location.href="/locations/map.jsp"}}}$.unblockUI()});if(initRegion!=""||initState!=""||initFacil!=""||initBroadScp!=""||initFaclType!=""){if(initRegion!=""){$("#modal_nav2").click();$("#select_region").val(initRegion);updateStateList();$("#btn_update_regionState").click()}else{if(initState!=""){$("#modal_nav2").click();$("#select_state").val(initState);$("#btn_update_regionState").click()}else{if(initFacil!=""){$("#modal_nav3").click();$("#select_facil").val(initFacil);$("#btn_update_facility").click()}else{if(initBroadScp!=""){$("#modal_nav4").click();$("#select_broadscope").val(initBroadScp);$("#btn_update_broadscope").click()}else{if(initFaclType!=""){mapFaclType(initFaclType)}}}}}};